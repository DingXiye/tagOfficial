<!DOCTYPE html>


<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>导入答案</title>

    <!--<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.1/build/reset/reset-min.css"/>-->
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../fonts/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="apply.css" rel="stylesheet">
    <link rel="stylesheet" href="../bootstrap-table/bootstrap-table.min.css">
    <!--<link rel="stylesheet" type="text/css" href="../css/style.min.css">-->
    <link rel="stylesheet" href="../css/header2.css" type="text/css" />
    <link rel="stylesheet" href="../css/fileUpload.css">
    <link rel="stylesheet" href="../bootstrap-table/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="../css/applyInfo2.css">

    <link rel="stylesheet" type="text/css" href="../css/buttons.css"/>
    <link rel="stylesheet" type="text/css" href="../css/resultFinal.css"/>
    <!--<link href="apply.css" rel="stylesheet" type="text/css" />-->

    <style type="text/css">

        /*html {
            background-color: #ddd;
            font: 62.5%/1 "Lucida Sans Unicode","Lucida Grande",Verdana,Arial,Helvetica,sans-serif;
        }*/
        body {
            padding: 20px 60px;
        }
        .bgimg{
            position: fixed;
            left:0px;
            top:0px;
            margin:auto;
            width:100%;
            height:100%;
            z-index:-1000;
        }
        .cover{
            position: fixed;
            left:0px;
            top:0px;
            z-index: -900;
            opacity: 0.8;
            height: 100%;
            width: 100%;
            background: black;
        }
        #wrapper { text-align: center; }


        /*It appears that the Pictos Font resets the line-height of the icon.. so if you are using them, delete the line below. */
        .icon:before { line-height: .7em; }

    </style>


</head>

<body>
<img src="../images/adminBg2.png" alt="" width='100%' height='100%' class="bgimg">
<header class="header fixed clearfix navbar navbar-fixed-top">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="header-left">
                    <div class="logo smooth-scroll">
                        <a href="../indexFinal.html"><img id="logo" src="http://pb2edde5m.bkt.clouddn.com/logo2.png" alt="Worthy"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<div class="container-fluid" style="height: 90%;">
    <div class="row">
        <div class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="text-center" style="font-size: 40px;color:#ffc400">
                        导入答案
                    </h2>
                </div>
            </div>
            <div class="row containerRow">
                <div class="col-md-12 childToTop">
                    <div class="col-md-1" style="padding: 0">
                    </div>
                    <!-- tab页 -->
                    <div class="col-md-10">

                        <!-- 结果提交 -->
                        <div class="row-fluid col-md-12 col-sm-12" style="border-bottom: 0;">
                            <div class="col-md-2 col-sm-12 col-xs-12 titleInfo" style="padding: 0">
                                <h4 class="title">
                                    导入答案
                                </h4>
                            </div>
                            <div class="col-md-10 group-info">
                                <div class="identifyContainer">

                                    <div class="col-md-10">
                                        <h4 class="sign" id="warning">
                                        </h4>
                                    </div>
                                    <div class="col-md-12">
                                        <form class="form-horizontal" enctype="multipart/form-data">
                                            <div style="padding: 0" id="Lpicture">
                                                <h3 style="    font-size: 14px; font-weight: bold;"><span class="required-flag">*</span>文件：</h3>
                                                <div class="fileArea" id="file1" style="padding-top:5px;">
                                                </div>
                                                <div class="col-md-2 idPic">
                                                            <span class="btn btn-info btn-small fileinput-button" style="padding: 4px 10px;font-size: 12px;">
                                                                <i class="glyphicon glyphicon-plus"></i>
                                                                <span>上传附件</span>
                                                                <input class="chooseFile disableAll" type="file" name="diploma" id="file1Cont" accept="application/json"/>
                                                            </span>
                                                </div>
                                                <div class="col-md-5 modifyPasBtnCon">
                                                    <div class="col-md-12">
                                                        <button type="button" class="btn  btn-success" id="ifSub" style="width: 70px;height: 27px;font-size: 12px;padding: 4px 0;" onclick="subFiles()">提交</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                            </div>

                        </div>


                    </div>
                    <!-- tab页结束 -->


                    <br/>
                </div>
            </div>
            <br>
            <br>
        </div>
    </div>

</div>

<!--<div id="wrapper">


</div>-->

<div style="text-align:center;clear:both;">
    <!-- JavaScript -->
    <script src="../js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>

    <script src="../js/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/jquery.base64.js"></script>
    <script src="../js/globalIP.js"></script>

    <script src="../bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../bootstrap-table/bootstrap-table-zh-CN.min.js"></script>

    <script src="../layer/layer.js"></script>
</div>
<script>
    let myTeamId = $.cookie("myTeamId");
    let username = $.cookie("myUsername");
    let password0 = $.cookie("myWPa");
    let password = $.base64.decode(password0);
    let token = username + ':' + password;

    window.onload = function () {
        //根据不同阶段显示不同标题
        /*if(id === "0"){
            document.getElementById("commitTitle").innerHTML = "训练结果提交"
        }else if(id === "1"){
            document.getElementById("commitTitle").innerHTML = "初赛结果提交"
        }else if(id === "2"){
            document.getElementById("commitTitle").innerHTML = "决赛结果提交"
        }*/

        //添加文件
        let file1 = document.getElementById("file1Cont");
        file1.onchange = function(){
            if(file1.value.length !== 0){
                let file = this.files[0];
                let divId = "file1";
                handleFile(file, divId);
            }
        }
    }

    function handleFile(file, divId){
        //获取文件名称
        let fileName = file.name;
        url=window.URL.createObjectURL(file);
        //清空文件列表
        let fileArea = document.getElementById(divId);
        fileArea.innerHTML = '';
        //添加到文件列表
        let html = '<div class="col-md-12 idPic">' +
            '<p class="fileName col-md-5 col-xs-12 idPic">' + fileName + '</p>' +
            '<div class="col-md-1 col-xs-3 idPic"><span class="delFile btn btn-danger btn-mini disableAll newAddFile" onclick="delFile(event)"' +
            ' style="cursor:pointer;padding: 3px 8px;font-size: 11px;border-radius: 3px;">删除</span></div>' +
            '</div>';

        let $fileArea = document.getElementById(divId);
        $(html).appendTo($fileArea);
    }

    function delFile(event){
        let e = event || window.event;
        let target = e.target || e.srcElement;
        let delDiv = target.parentNode.parentNode;
        let id1 = delDiv.parentNode.id;
        let $fileArea = document.getElementById(id1);
        $fileArea.removeChild(delDiv);
        let fileCont = document.getElementById("file1Cont");
        fileCont.value = '';
    }

    function subFiles() {
        let file1 = document.getElementById("file1Cont").files[0];  //获取文件
        //console.log(file1);
        if(typeof (file1) !== "undefined"){
            let formData = new FormData();
            formData.append("doc", file1);
            layer.msg('正在导入...', {
                icon: 16,
                shade: 0.01,
                time: false //取消自动关闭
            });
            $.ajax({
                url: IpAll() + "finals/import",
                data: formData,
                type: "POST",
                async: true,
                dataType: "json",
                cache: false,
                processData: false,
                contentType: false,
                enctype: 'multipart/form-data',
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Authorization', 'Basic ' + btoa(token));
                },
                timeout : 120000,
                success: function (result) {
                    layer.alert('导入成功', {
                        closeBtn: 0,    // 是否显示关闭按钮
                        anim: 0,//动画类型
                        btn: ['确定'],//按钮
                        icon: 6,    // icon
                        yes:function(){
                            layer.closeAll();
                        }});
                },
                error : function(error) {
                    layer.closeAll();
                    if(error.responseJSON && error.responseJSON.message){
                        let notifyMessage = error.responseJSON.message
                        layer.alert(notifyMessage, {
                            closeBtn: 0,    // 是否显示关闭按钮
                            anim: 0,//动画类型
                            btn: ['确定'],//按钮
                            icon: 5,    // icon
                            yes:function(){
                                layer.closeAll();
                            }});
                    }else{
                        layer.alert('请求超时', {
                            closeBtn: 0,    // 是否显示关闭按钮
                            anim: 0,//动画类型
                            btn: ['确定'],//按钮
                            icon: 5,    // icon
                            yes:function(){
                                layer.closeAll();
                            }});
                    }
                }
            });
        }else {
            alert("请先选择文件");
        }

    }

</script>
</body>

</html>

